<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-i18n="dashboard.model.title">Panel del Modelo — RedVelvetLive</title>
  <meta name="description" content="Estadísticas del modelo: ganancias, tips, ranking, agenda y actividad reciente.">
  <link rel="canonical" href="https://www.redvelvetlive.com/model-dashboard.html">
  <meta name="color-scheme" content="dark light">

  <!-- OG -->
  <meta property="og:title" content="Panel del Modelo — RedVelvetLive">
  <meta property="og:description" content="Controla tus ganancias, tips, ranking y próximas transmisiones.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.redvelvetlive.com/model-dashboard.html">
  <meta property="og:image" content="/assets/hero/cover.webp">

  <!-- Fuentes + CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <!-- Header -->
  <div data-include="header"></div>

  <main class="main-container">
    <!-- Título -->
    <section class="panel fade-in" aria-labelledby="dashTitle">
      <div class="panel-header">
        <h1 id="dashTitle">
          <span data-i18n="dashboard.model.heading">Hola, </span>
          <span id="modelName">—</span>
        </h1>
        <p class="muted">
          <span data-i18n="dashboard.role">Tu rol:</span> <strong>Modelo</strong>
        </p>
      </div>

      <!-- KPIs -->
      <div class="cards-grid" style="--grid-min: 220px;">
        <article class="card kpi">
          <div class="kicker" data-i18n="dashboard.kpi.tipsReceived24h">Tips recibidos (24h)</div>
          <div class="kpi-value" id="kpiTips24h">—</div>
        </article>
        <article class="card kpi">
          <div class="kicker" data-i18n="dashboard.kpi.subscribers">Suscriptores</div>
          <div class="kpi-value" id="kpiSubs">—</div>
        </article>
        <article class="card kpi">
          <div class="kicker" data-i18n="dashboard.kpi.balanceOnecop">Saldo (ONECOP)</div>
          <div class="kpi-value" id="kpiBalance">—</div>
        </article>
      </div>
    </section>

    <!-- Próxima transmisión + banner -->
    <section class="panel fade-in">
      <div class="grid grid-2" style="--grid-min:280px">
        <article class="card">
          <h3 data-i18n="dashboard.model.nextStream">Próxima transmisión</h3>
          <p class="muted">
            <span data-i18n="dashboard.model.nextStreamTime">Hoy 20:00</span> — <span id="nextStreamTitle">—</span>
          </p>
          <div class="actions" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px;">
            <a class="btn primary" href="/live-room.html" id="btnGoLive">Ir a sala</a>
            <a class="btn" href="/settings.html" data-i18n="actions.configure">Configurar</a>
          </div>
        </article>

        <article class="card" style="padding:0; overflow:hidden;">
          <img src="/assets/hero/cover.webp" alt="Promoción de fin de semana" style="width:100%; height:220px; object-fit:cover;">
        </article>
      </div>
    </section>

    <!-- Actividad reciente -->
    <section class="panel fade-in" aria-labelledby="recentTitle">
      <div class="panel-header">
        <h2 id="recentTitle">Actividad reciente</h2>
      </div>

      <div class="card table-like" role="region" aria-live="polite">
        <div class="table-head">
          <div data-i18n="table.date">Fecha</div>
          <div data-i18n="table.action">Acción</div>
          <div data-i18n="table.detail">Detalle</div>
        </div>

        <div id="activityBody" class="table-body">
          <div class="row skeleton-row"></div>
          <div class="row skeleton-row"></div>
          <div class="row skeleton-row"></div>
        </div>

        <div id="activityEmpty" class="muted" style="display:none" data-i18n="table.loading">Cargando…</div>
      </div>
    </section>

    <!-- Accesos rápidos -->
    <section class="panel fade-in" aria-labelledby="quickTitle">
      <div class="panel-header"><h2 id="quickTitle">Acciones rápidas</h2></div>
      <div class="cards-grid" style="--grid-min: 260px;">
        <article class="card">
          <div class="kicker">Monetización</div>
          <p class="muted">Revisa tarifas, metas de tips y subs.</p>
          <a class="btn" href="/notifications.html" data-i18n="actions.configure">Configurar</a>
        </article>
        <article class="card">
          <div class="kicker">Wallet</div>
          <p class="muted">Conecta/verifica tu billetera ONECOP.</p>
          <a class="btn" href="/wallet.html" data-i18n="actions.configure">Configurar</a>
        </article>
        <article class="card">
          <div class="kicker">Soporte</div>
          <p class="muted">¿Dudas técnicas o de seguridad? abre un ticket.</p>
          <a class="btn" href="/support.html" data-i18n="actions.configure">Abrir ticket</a>
        </article>
      </div>
    </section>

    <!-- Checklist -->
    <section class="panel panel-accent fade-in" aria-labelledby="checkTitle">
      <div class="panel-header"><h2 id="checkTitle">Checklist rápido</h2></div>
      <div class="grid grid-2">
        <ul role="list" class="card" style="margin:0;">
          <li>✔️ Cámara, mic y luz probados</li>
          <li>✔️ Moderación activa</li>
          <li>✔️ Mensaje de bienvenida</li>
        </ul>
        <ul role="list" class="card" style="margin:0;">
          <li>✔️ Wallet verificada</li>
          <li>✔️ Metas visibles</li>
          <li>✔️ Horario publicado</li>
        </ul>
      </div>
      <div class="actions" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <a class="btn primary" href="/live-room.html">Transmitir ahora</a>
        <a class="btn" href="/settings.html">Ajustes</a>
      </div>
    </section>
  </main>

  <!-- Footer y cookies -->
  <div data-include="cookies"></div>
  <div data-include="footer"></div>

  <!-- Configuración global -->
  <script>
    window.API_BASE  = window.API_BASE  || '/api';
    window.AUTH_BASE = window.AUTH_BASE || '/auth';
  </script>

  <!-- Scripts -->
  <script src="/js/includes.js" defer></script>
  <script src="/js/navigation.js" defer></script>

  <!-- Hidratación de datos -->
  <script>
    (function(){
      const $ = (s,r=document)=>r.querySelector(s);
      const API = (p,opts={}) =>
        fetch((window.API_BASE||'/api')+p, Object.assign({credentials:'include'},opts))
          .then(async res=>{ if(!res.ok) throw new Error(await res.text()||('HTTP '+res.status)); try{return await res.json();}catch{return null;} });

      function setText(sel,val){ const el=$(sel); if(el) el.textContent = (val ?? '—'); }

      function fillActivity(rows){
        const body = $('#activityBody'); const empty = $('#activityEmpty');
        if(!body) return;
        body.innerHTML = '';
        if(!rows || !rows.length){ empty.style.display=''; return; }
        empty.style.display='none';
        rows.forEach(r=>{
          const row = document.createElement('div');
          row.className='row';
          row.innerHTML = `
            <div>${new Date(r.date||Date.now()).toLocaleString()}</div>
            <div>${r.action||'-'}</div>
            <div class="muted">${r.detail||''}</div>
          `;
          body.appendChild(row);
        });
      }

      async function hydrate(){
        try{
          const prof = await API('/users/profile').catch(()=>null);
          setText('#modelName', (prof && (prof.displayName||prof.username||prof.email)) || '—');

          const kpis = await API('/model/kpis').catch(()=>null);
          setText('#kpiTips24h', kpis?.tipsReceived24h ?? 0);
          setText('#kpiSubs',    kpis?.subscribers ?? 0);
          setText('#kpiBalance', kpis?.balanceOnecop ?? 0);

          const next = await API('/model/next-stream').catch(()=>null);
          if (next) {
            setText('#nextStreamTitle', next.title || 'En vivo');
            const go = document.getElementById('btnGoLive');
            if (go && next.roomId) go.href = `/live-room.html?id=${encodeURIComponent(next.roomId)}`;
          }

          const rec = await API('/model/activity?limit=10').catch(()=>null);
          fillActivity(rec && rec.items ? rec.items : rec);
        }catch(e){
          setText('#modelName', 'Modelo');
          setText('#kpiTips24h', 12);
          setText('#kpiSubs', 48);
          setText('#kpiBalance', 230.5);
          setText('#nextStreamTitle', 'Sesión nocturna');
          fillActivity([
            {date: Date.now()-3_600_000, action:'Tip recibido', detail:'+5 ONECOP de @Leo'},
            {date: Date.now()-6_000_000, action:'Nuevo seguidor', detail:'@Cami te sigue'},
            {date: Date.now()-8_000_000, action:'Meta alcanzada', detail:'“50 cheers”'}
          ]);
          console.warn('Model dashboard fallback');
        }
      }

      document.addEventListener('DOMContentLoaded', hydrate);
    })();
  </script>

  <style>
    .table-like .row, .skeleton-row { min-height: 42px; }
  </style>
</body>
</html>
